Chat para aula de Sistemas Distribuídos - FATEC Carapicuiba - Prof. Luquini - 2015

<h1>Links para projetos de outros alunos</h1> 
<ul>
  <li><a href="https://github.com/andbreder/Chat_C-">Anderson Breder</li>
  <li><a href="https://github.com/felipej26/Chat_UDP">Jefferson Felipe</li>
</ul>

<h1>Especificação</h1>
<h2 class="c2 c6"><a name="h.h3phrwl5sfn1"></a><span class="c1">1. </span><span class="c1">Geral</span></h2><h3 class="c2 c6"><a name="h.tat390719rnq"></a><span>1.1 </span><span>Sobre</span></h3><p class="c2"><span>A inspira&ccedil;&atilde;o para esse modelo foi encontrada nas salas de bate-papo muito utilizadas na d&eacute;cada de 90. Uma diferen&ccedil;a fundamental em rela&ccedil;&atilde;o ao modelo original &eacute; que o protocolo &eacute; desenvolvido com base em uma arquitetura P2P, o que leva &agrave; diferen&ccedil;as fundamentais em seu funcionamento.</span></p><h3 class="c2 c6"><a name="h.g4audnrzgldf"></a><span>1.2 Funcionalidades</span></h3><ul class="c11 lst-kix_oqn530bj1d6z-0 start"><li class="c2 c3"><span>Usu&aacute;rios identificados por nome</span></li><li class="c2 c3"><span>Aviso quando usu&aacute;rio entra ou sai da sala</span></li><li class="c2 c3"><span>Envio de mensagens globais</span><span>&nbsp;(para toda &agrave; lista)</span></li><li class="c2 c3"><span>Envio de mensagens privadas</span><span>&nbsp;(um usu&aacute;rio selecionado)</span></li><li class="c2 c3"><span>Timestamp</span><span>(&ldquo;hh:mm:ss&rdquo; - hora:min:seg)</span><span>&nbsp;nas mensagens</span></li></ul><h3 class="c2 c6"><a name="h.x9xsnyz74453"></a><span>1.3 Exemplo de funcionamento</span></h3><p class="c2"><span>13:01:45 Vader entra na sala</span></p><p class="c2"><span>13:02:05 Vader diz a todos: Sauda&ccedil;&otilde;es!</span></p><p class="c2"><span>13:02:59 Yoda diz a Vader: N&atilde;o o vejo, muito tempo faz!</span></p><p class="c2"><span>13:02:59 Vader sussurra para Luke: Fico feliz em v&ecirc;-lo...</span></p><h3 class="c2 c6"><a name="h.43azyepscd1u"></a><span>1.4 Princ&iacute;pio de funcionamento</span></h3><p class="c2"><span>Para que os usu&aacute;rios sejam identificados, &eacute; necess&aacute;rio que se mantenha uma lista de todos que est&atilde;o no chat em um dado momento. Como n&atilde;o h&aacute; um servidor central, a solu&ccedil;&atilde;o adotada &eacute; que cada usu&aacute;rio mantenha uma lista atualizada de participantes. Essa lista deve conter a rela&ccedil;&atilde;o do ip e o nickname de cada usu&aacute;rio, </span><span>al&eacute;m de uma timestamp que indica quando foi a &uacute;ltima atividade recebida desse usu&aacute;rio.</span></p><p class="c0"><span></span></p><p class="c2"><span>Com essa lista, cada aplica&ccedil;&atilde;o ser&aacute; respons&aacute;vel por gerar as mensagens de forma amig&aacute;vel, contendo o nickname do usu&aacute;rio que enviou, qual a a&ccedil;&atilde;o executada e a mensagem em si.</span></p><p class="c0"><span></span></p><p class="c2"><span>O protocolo define par&acirc;metros que s&atilde;o enviados no corpo da mensagem, por&eacute;m, nem todos esses par&acirc;metros s&atilde;o exibidos na tela. A mensagem, em sua forma completa, serve para indicar &agrave; aplica&ccedil;&atilde;o final o que deve ser impresso na tela, assim como serve tamb&eacute;m para manuten&ccedil;&atilde;o da lista de usu&aacute;rios.</span></p><h2 class="c2 c6"><a name="h.vvz1nr8a4374"></a><span class="c1">2. Modelo de comunica&ccedil;&atilde;o</span></h2><h3 class="c2 c6"><a name="h.ournddcg96p1"></a><span>2.1 Formato</span></h3><p class="c2"><span>As mensagens ser&atilde;o trocadas dentro do formato JSON, devido &agrave; este ser um formato simples e tamb&eacute;m &agrave; existencia de parsers para este formato em todas as linguagens modernas. Segue um exemplo de mensagem:</span></p><p class="c0"><span></span></p><p class="c2"><span>{</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;target&rdquo;:&rdquo;192.168.0.125&rdquo;,</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;action&rdquo;:&ldquo;say&rdquo;,</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;content&rdquo;: &ldquo;Ol&aacute;!&ldquo;</span></p><p class="c2"><span>}</span></p><p class="c0"><span></span></p><p class="c2"><span>Os par&acirc;metros contidos na mensagem variam de acordo </span><span>&agrave; a&ccedil;&atilde;o</span><span>(</span><span>action</span><span>) </span><span>desejada</span><span>. </span><span class="c15">Deve se considerar o nome dos par&acirc;metros e conte&uacute;do do par&acirc;metro &ldquo;action&rdquo; como </span><span class="c15">case-sensitive</span><sup></sup><sup></sup><span class="c15">.</span></p><p class="c0"><span></span></p><p class="c2"><span class="c1">Listagem de a&ccedil;&otilde;es poss&iacute;veis:</span></p><ul class="c11 lst-kix_jlfh7h685jie-0 start"><li class="c2 c3"><span>search: </span><span>mensagem em broadcast para buscar usu&aacute;rios</span></li></ul><ul class="c11 lst-kix_1d3zztcgk0az-0 start"><li class="c2 c3"><span>keepAlive</span><span>: informa as demais usu&aacute;rios quem est&aacute; ativo, troca a lista de usu&aacute;rios</span></li><li class="c2 c3"><span>say: mensagem de tipo aberto, pode ser lida por todos</span></li><li class="c2 c3"><span>whisper: mensagem restrita a um usu&aacute;rio</span></li><li class="c2 c3"><span>leave: indica que o usu&aacute;rio saiu da sala</span></li><li class="c2 c3"><span>report: informa &agrave; um usu&aacute;rio um erro de comunica&ccedil;&atilde;o</span></li></ul><h3 class="c2 c6"><a name="h.1elobfs6xpdc"></a><span>2.2 Detalhamento das </span><span>A&ccedil;&otilde;es</span><span>:</span></h3><h4 class="c2 c6"><a name="h.hh96swkzsqi7"></a><span>Search:</span></h4><p class="c2"><span>Tem por objetivo encontrar usu&aacute;rios ativos. &Eacute; a primeira a&ccedil;&atilde;o a ser executada ao iniciar o programa, e deve se repetida a cada 2 segundos at&eacute; se obter uma resposta. </span></p><p class="c2"><span class="c1">Modo de envio</span><span>: broadcast</span></p><p class="c2"><span class="c1">Par&acirc;metro: </span><span>action,</span><span class="c1">&nbsp;</span><span>nickname</span></p><p class="c2"><span class="c1">Modelo</span><span>:</span></p><p class="c2"><span>{</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;action&rdquo;:&ldquo;search&rdquo;,</span></p><p class="c2"><span>&nbsp; &nbsp;</span><span>&ldquo;nickname&rdquo;: &ldquo;Luke&rdquo;</span></p><p class="c2"><span>}</span></p><h4 class="c2 c6"><a name="h.umo79r9mzw2g"></a><span>KeepAlive</span><span>:</span></h4><p class="c2"><span>Essa a&ccedil;&atilde;o deve ser enviada em resposta de qualquer </span><span>a&ccedil;&atilde;o </span><span>Search que seja recebida, indicando assim ao usu&aacute;rio ingressante quem est&aacute; na sala</span><span>. Al&eacute;m disso, ela deve ser enviada a cada 10 segundos para indicar que o usu&aacute;rio continua ativo. A informa&ccedil;&otilde;es sobre o emissor do keepAlive &eacute; utilizada para dar manuten&ccedil;&atilde;o na lista de usu&aacute;rios que est&atilde;o ativos, se o usu&aacute;rio deixar de enviar o keepAlive, ele ser&aacute; removido da lista dos usu&aacute;rios ativos. A infoprma&ccedil;&otilde;es sobre os usu&aacute;rios contida na mensagem de keepAlive &eacute; usada somente para inclus&atilde;o de usu&aacute;rios que ainda n&atilde;o est&atilde; na lista do receptor. Essa lista n&atilde;o deve ser utilizada para exclus&atilde;o dos usu&aacute;rios.</span></p><p class="c0"><span></span></p><p class="c2"><span>Ver item 4 para mais detalhes sobre a&ccedil;&otilde;es que alteram a lista de usu&aacute;rios.</span></p><p class="c0"><span></span></p><p class="c2"><span class="c1">Modo de envio</span><span>: multicast</span></p><p class="c2"><span class="c1">Par&acirc;metro: </span><span>action,</span><span class="c1">&nbsp;</span><span>nickname</span></p><p class="c2"><span class="c1">Modelo</span><span>:</span></p><p class="c2"><span>{</span></p><p class="c2"><span>&nbsp; &nbsp;</span><span>&ldquo;action&rdquo;:&ldquo;keepAlive&rdquo;,</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;nickname&rdquo;: &ldquo;Vader&ldquo;,</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;</span><span>users</span><sup></sup><span>&rdquo; : </span><span class="c15">[</span></p><p class="c2"><span>&nbsp; &nbsp; &nbsp; &nbsp;{&ldquo;nickname&rdquo;:&rdquo;Luke&rdquo;, &ldquo;address&rdquo;:&ldquo;192.168.0.1&rdquo;},</span></p><p class="c2"><span>&nbsp; &nbsp; &nbsp; &nbsp;{&ldquo;nickname&rdquo;:&rdquo;Yoda&rdquo;, &ldquo;address&rdquo;:&ldquo;192.168.0.4&rdquo;},</span></p><p class="c2"><span>&nbsp; &nbsp; &nbsp; &nbsp;{&ldquo;nickname&rdquo;:&rdquo;R2D2&rdquo;, &ldquo;address&rdquo;:&ldquo;192.168.0.6&rdquo;}</span></p><p class="c2"><span>&nbsp; &nbsp; </span><span class="c15">]</span></p><p class="c2"><span>}</span></p><h4 class="c2 c6"><a name="h.38tvs2d3ch6o"></a><span>Say:</span></h4><p class="c2"><span>Envia uma mensagem &agrave; um usu&aacute;rio espec&iacute;fico ou a todo o grupo. Note que essa mensagem n&atilde;o &eacute; oculta: todos podem ler o que foi enviado. O par&acirc;metro target serve unicamente para endere&ccedil;ar a mensagem, e, quando ausente, indica que a mensagem foi direcionada &agrave; todos da sala.</span></p><p class="c2"><span class="c1">Modo de envio</span><span>: multicast</span></p><p class="c2"><span class="c1">Par&acirc;metros obrigat&oacute;rios: </span><span>action,</span><span class="c1">&nbsp;</span><span>value</span></p><p class="c2"><span class="c1">Modelo</span><span>:</span></p><p class="c2"><span>{</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;target&rdquo;:&rdquo;192.168.0.125&rdquo;,</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;action&rdquo;:&ldquo;say&rdquo;,</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;content&rdquo;: &ldquo;Ol&aacute;!&ldquo;</span></p><p class="c2"><span>}</span></p><h4 class="c2 c6"><a name="h.cg23jfgtqftq"></a><span>Whisper:</span></h4><p class="c2"><span>Envia uma mensagem &agrave; um usu&aacute;rio espec&iacute;fico de forma oculta. Essa mensagem n&atilde;o deve ser enviada por multicast para que outros usu&aacute;rios n&atilde;o tenham acesso &agrave; ela. O par&acirc;metro content carrega o conte&uacute;do da mensagem.</span></p><p class="c2"><span class="c1">Modo de envio</span><span>: direcionado &agrave; um ip</span></p><p class="c2"><span class="c1">Par&acirc;metros obrigat&oacute;rios: </span><span>action,</span><span class="c1">&nbsp;</span><span>value</span></p><p class="c2"><span class="c1">Modelo</span><span>:</span></p><p class="c2"><span>{</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;action&rdquo;:&ldquo;whisper&rdquo;,</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;content&rdquo;: &ldquo;Ol&aacute;, jos&eacute;, como vai?&ldquo;</span></p><p class="c2"><span>}</span></p><h4 class="c2 c6"><a name="h.mr55lqoaexre"></a><span>Leave:</span></h4><p class="c2"><span>Indica que o usu&aacute;rio saiu da sala.</span></p><p class="c2"><span class="c1">Par&acirc;metros obrigat&oacute;rios: </span><span>action</span></p><p class="c2"><span class="c1">Modo de envio</span><span>: multicast</span></p><p class="c2"><span class="c1">Modelo</span><span>:</span></p><p class="c2"><span>{</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;action&rdquo;:&ldquo;leave&rdquo;,</span></p><p class="c2"><span>}</span></p><p class="c0"><span></span></p><h4 class="c2 c6"><a name="h.lb3ykqjdx1ki"></a><span>Report:</span></h4><p class="c2"><span>Indica que &agrave; um usu&aacute;rio que houve um erro de comunica&ccedil;&atilde;o. Deve ser enviada automaticamente em caso de um JSON mal formado, ou de uma action com par&acirc;metros obrigat&oacute;rios ausentes.</span></p><p class="c2"><span class="c1">Par&acirc;metros obrigat&oacute;rios: </span><span>action, message</span></p><p class="c2"><span class="c1">Modo de envio</span><span>: direcionado &agrave; um ip</span></p><p class="c2"><span class="c1">Modelo</span><span>:</span></p><p class="c2"><span>{</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;action&rdquo;:&ldquo;report&rdquo;,</span></p><p class="c2"><span>&nbsp; &nbsp;&ldquo;message&rdquo;: &ldquo;JSON parse error&rdquo;</span></p><p class="c2"><span>}</span></p><h2 class="c2 c6"><a name="h.opx82f7vb2c1"></a><span class="c1">3. Sequ&ecirc;ncia da </span><span class="c1">aplica&ccedil;&atilde;o</span><sup></sup><sup></sup></h2><ol class="c11 lst-kix_2c5fbiof3ta8-0 start" start="1"><li class="c2 c3"><span>Inicia-se a procura </span><span>de usu&aacute;rios</span><span>&nbsp;atrav&eacute;s do comando Search</span></li></ol><ol class="c11 lst-kix_2c5fbiof3ta8-1 start" start="1"><li class="c2 c12"><span>Caso n&atilde;o recebe nenhuma resposta, deve repetir a a&ccedil;&atilde;o </span><span>numa frequ&ecirc;ncia de 2 segundos</span></li><li class="c2 c12"><span>Receber&aacute; a resposta dos demais usu&aacute;rios atrav&eacute;s da a&ccedil;&atilde;o </span><span>keepAlive</span><span>. </span><span>Para cada resposta recebida, deve adicionar o endere&ccedil;o e nickname do usu&aacute;rio &agrave; sua lista</span></li></ol><ol class="c11 lst-kix_2c5fbiof3ta8-0" start="2"><li class="c2 c3"><span>O usu&aacute;rio encontra-se estabelecido </span><span>no ambiente</span><span>&nbsp;de chat</span></li></ol><ol class="c11 lst-kix_2c5fbiof3ta8-1 start" start="1"><li class="c2 c12"><span>Pode ent&atilde;o realizar as a&ccedil;&otilde;es de conversa (Say e Whisper)</span></li><li class="c2 c12"><span>Deve utilizar a a&ccedil;&atilde;o Search &agrave; cada 10 segundos para confirmar os usu&aacute;rios ativos. Caso existam respostas de usu&aacute;rios que n&atilde;o foram previamente identificados, estes devem ser adicionados &agrave; lista.</span></li><li class="c2 c12"><span class="c15">Caso todos os usu&aacute;rios saiam da sala, deve voltar ao passo I</span></li></ol><ol class="c11 lst-kix_2c5fbiof3ta8-0" start="3"><li class="c2 c3"><span>Para sair da sala, deve informar os demais usu&aacute;rios com a a&ccedil;&atilde;o Leave</span></li></ol><ol class="c11 lst-kix_2c5fbiof3ta8-1 start" start="1"><li class="c2 c12"><span>Ao receber a a&ccedil;&atilde;o Leave de um terceiro, deve-se remover esse usu&aacute;rio da lista de usu&aacute;rios</span></li></ol><p class="c0"><span></span></p><h2 class="c2 c6"><a name="h.p20tjs20rnvd"></a><span class="c1">4. Sistema de impress&atilde;o de mensagens</span></h2><h3 class="c2 c6"><a name="h.u358x5e342cm"></a><span class="c8">4.1 Geral</span></h3><p class="c2"><span>Nem todas as a&ccedil;&otilde;es que trafegam pelo sistema s&atilde;o exibidas aos usu&aacute;rios finais. Al&eacute;m de filtrar apenas o que &eacute; relevante ao usu&aacute;rio, tamb&eacute;m &eacute; necess&aacute;rio formatar as mensagens de forma que o chat se torne amig&aacute;vel e agrad&aacute;vel. Seguem as especifica&ccedil;&otilde;es de como filtrar e formatar o conte&uacute;do &agrave; ser exibido.</span></p><h3 class="c2 c6"><a name="h.pnyqefm0cq30"></a><span class="c8">4.2 Detalhamento de impress&atilde;o para cada a&ccedil;&atilde;o</span></h3><h4 class="c2 c6"><a name="h.hg2cgpzbp4p9"></a><span class="c8">Search</span></h4><ol class="c11 lst-kix_pabdqzwrgu2e-0 start" start="1"><li class="c2 c3"><span>Quando se est&aacute; &agrave; ingressar na aplica&ccedil;&atilde;o, &agrave; procura de usu&aacute;rios:</span></li></ol><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Envia</span><span>: {&ldquo;action&rdquo;:&rdquo;search&rdquo;, &ldquo;nickname&rdquo;:&rdquo;Luke&rdquo;}</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Imprime:</span><span>&nbsp;</span><span class="c7">Procurando usu&aacute;rios ativos&hellip;</span></p><p class="c0"><span class="c7"></span></p><ol class="c11 lst-kix_pabdqzwrgu2e-0" start="2"><li class="c2 c3"><span>Quando se recebe uma mensagem de search de um novo usu&aacute;rio:</span></li></ol><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Recebe</span><span>: {&ldquo;action&rdquo;:&rdquo;search&rdquo;, &ldquo;nickname&rdquo;:&rdquo;Vader&rdquo;}</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Imprime:</span><span>&nbsp;</span><span class="c7">Vader entrou na sala&hellip;</span></p><h4 class="c2 c6"><a name="h.rmqpjww0p0vn"></a><span class="c8">KeepAlive</span></h4><ol class="c11 lst-kix_1zmuf17lgoij-0 start" start="1"><li class="c2 c3"><span>Quando se recebe de um usu&aacute;rio n&atilde;o identificado:</span></li></ol><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Recebe</span><span>: {&ldquo;action&rdquo;:&rdquo;keepAlive&rdquo;, &ldquo;nickname&rdquo;:&rdquo;Vader&rdquo; }</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Impress&atilde;o:</span><span>&nbsp;</span><span class="c7">Vader entrou na sala.</span></p><p class="c0"><span class="c7"></span></p><ol class="c11 lst-kix_1zmuf17lgoij-0" start="2"><li class="c2 c3"><span>Quando se recebe de um usu&aacute;rio previamente identificado:</span></li></ol><p class="c2 c14"><span class="c1">Recebe</span><span>: {&ldquo;action&rdquo;:&rdquo;keepAlive&rdquo;, &ldquo;nickname&rdquo;:&rdquo;Vader&rdquo;}</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Impress&atilde;o:</span><span>&nbsp;</span><span class="c7">[N&atilde;o h&aacute; impress&atilde;o]</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c7"></span></p><ol class="c11 lst-kix_1zmuf17lgoij-0" start="3"><li class="c2 c3"><span>Quando um usu&aacute;rio conhecido n&atilde;o responde por 10 segundos</span></li></ol><p class="c2 c14"><span class="c1">Impress&atilde;o</span><span>: </span><span class="c7">Vader est&aacute; ausente...</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><h4 class="c2 c6"><a name="h.a4oq6jrbjs9"></a><span class="c8">Say</span></h4><ol class="c11 lst-kix_k5xhhhtvl53s-0 start" start="1"><li class="c2 c3"><span>Quando possui par&acirc;metro target:</span></li></ol><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Recebe</span><span>: {&ldquo;action&rdquo;:&rdquo;say&rdquo;, &ldquo;target&rdquo;:&rdquo;192.168.0.3&rdquo;, &ldquo;content&rdquo;: &ldquo;Sauda&ccedil;&otilde;es!&rdquo;}</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Impress&atilde;o:</span><span>&nbsp;</span><span class="c7">Vader diz &agrave; R2D2: Sauda&ccedil;&otilde;es!</span></p><p class="c0"><span class="c7"></span></p><ol class="c11 lst-kix_k5xhhhtvl53s-0" start="2"><li class="c2 c3"><span>Quando n&atilde;o possui o par&acirc;metro target:</span></li></ol><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Recebe</span><span>: {&ldquo;action&rdquo;:&rdquo;say&rdquo;, &nbsp;&ldquo;content&rdquo;: &ldquo;Sauda&ccedil;&otilde;es!&rdquo;}</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Impress&atilde;o:</span><span>&nbsp;</span><span class="c7">Vader diz &agrave; todos: Sauda&ccedil;&otilde;es!</span></p><p class="c0"><span class="c7"></span></p><h4 class="c2 c6"><a name="h.6g1ajx3n7o0a"></a><span class="c8">Whisper</span></h4><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Recebe</span><span>: {&ldquo;action&rdquo;:&rdquo;whisper&rdquo;, &nbsp;&ldquo;content&rdquo;: &ldquo;Eu sou seu pai!&rdquo;}</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Impress&atilde;o:</span><span>&nbsp;</span><span class="c7">Vader sussurra &agrave; Luke: Eu sou seu pai!</span></p><p class="c0"><span class="c7"></span></p><h4 class="c2 c6"><a name="h.7lrehxkcae69"></a><span class="c8">Leave</span></h4><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Recebe</span><span>: {&ldquo;action&rdquo;:&rdquo;leave&rdquo;}</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Impress&atilde;o:</span><span>&nbsp;</span><span class="c7">Vader saiu da sala.</span></p><p class="c0"><span class="c7"></span></p><h4 class="c2 c6"><a name="h.qdax6u2cltjd"></a><span class="c8">Report</span></h4><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Recebe</span><span>: {&ldquo;action&rdquo;:&rdquo;report&rdquo;, &ldquo;message&rdquo;:&rdquo;JSON parse error&rdquo;}</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Impress&atilde;o:</span><span>&nbsp;</span><span class="c7">Vader reportou um erro: JSON parse error</span></p><h2 class="c2 c6"><a name="h.pju3v0dnmkd0"></a><span class="c1">4. Manuten&ccedil;&atilde;o da lista de usu&aacute;rios</span></h2><h3 class="c2 c6"><a name="h.pmu3wmj9w3pa"></a><span class="c8">4.1 Entidade Usu&aacute;rio</span></h3><p class="c2"><span>Um usu&aacute;rio precisa ser mantido na lista com 4 informa&ccedil;&otilde;es b&aacute;sicas:</span></p><ol class="c11 lst-kix_cceto82vowch-0 start" start="1"><li class="c2 c3"><span>Nickname: nome amig&aacute;vel do usu&aacute;rio, informado atrav&eacute;s das a&ccedil;&otilde;es search ou </span><span>keepAlive</span></li><li class="c2 c3"><span>Address: endere&ccedil;o de IP do usu&aacute;rio. Note que esse endere&ccedil;o nunca &eacute; informado em uma a&ccedil;&atilde;o, ele &eacute; obtido pela aplica&ccedil;&atilde;o atrav&eacute;s da identifica&ccedil;&atilde;o do IP de origem de uma mensagem.</span></li><li class="c2 c3"><span>Timestamp: &Uacute;ltima mensagem de </span><span>keepAlive </span><span>ou search recebida desse usu&aacute;rio</span></li></ol><h3 class="c2 c6"><a name="h.u5pd9scfkj7z"></a><span class="c8">4.2 Exemplo de lista de usu&aacute;rios</span></h3><p class="c2"><span>A lista ser&aacute; apresentada em JSON apenas para facilitar o entendimento. Ela ser&aacute; implementada de acordo &agrave; linguagem escolhida.</span></p><p class="c0"><span></span></p><p class="c2"><span>{</span></p><p class="c2 c14"><span>{&ldquo;address&rdquo;: 192.168.0.2, &ldquo;nickname&rdquo;:&rdquo;Vader&rdquo;, &ldquo;timestamp&rdquo;:144747</span><span>0110</span><span>},</span></p><p class="c2 c14"><span>{&ldquo;address&rdquo;: 192.168.0.3, &ldquo;nickname&rdquo;:&rdquo;Yoda&rdquo;, &ldquo;timestamp&rdquo;:144747</span><span>0103</span><span>},</span></p><p class="c2 c14"><span>{&ldquo;address&rdquo;: 192.168.0.13, &ldquo;nickname&rdquo;:&rdquo;R2D2&rdquo;, &ldquo;timestamp&rdquo;:14474</span><span>6080</span><span>},</span></p><p class="c2"><span>} </span></p><h3 class="c2 c6"><a name="h.vsprvhjgl39h"></a><span class="c8">4.3 A&ccedil;&otilde;es que alteram a lista de usu&aacute;rios</span></h3><ol class="c11 lst-kix_r546z2199la6-0 start" start="1"><li class="c2 c3"><span>Ao executar uma a&ccedil;&atilde;o de search: cada resposta </span><span>keepAlive </span><span>recebida deve adicionar o usu&aacute;rio &agrave; lista</span></li><li class="c2 c3"><span>Ao receber uma a&ccedil;&atilde;o search de um novo usu&aacute;rio: deve se adicionar o usu&aacute;rio &agrave; lista</span></li><li class="c2 c3"><span>Ao receber uma a&ccedil;&atilde;o leave de um usu&aacute;rio: deve se remover o usu&aacute;rio da lista</span></li><li class="c2 c3"><span>Ao enviar ou receber uma a&ccedil;&atilde;o de keepAlive para verificar se usu&aacute;rios permanecem ativos: ver detalhes no pr&oacute;ximo ponto (4.4)</span></li></ol><p class="c0"><span></span></p><h3 class="c2 c6"><a name="h.5rmi67s32t72"></a><span class="c8">4.4 A&ccedil;&atilde;o keepAlive para manuten&ccedil;&atilde;o da lista</span></h3><p class="c2"><span>A a&ccedil;&atilde;o keepAlive deve ser repetida &agrave; cada 10 segundos para verificar se os usu&aacute;rios permanecem ativos. A lista de usu&aacute;rios deve ser enviada para que os sejam identificados usu&aacute;rios que, por motivos de falha de comunica&ccedil;&atilde;o, n&atilde;o tenha tenham respondido &agrave; a&ccedil;&atilde;o de search inicial. Segue o fluxo de como essa a&ccedil;&atilde;o deve ser repetida:</span></p><p class="c0"><span></span></p><ol class="c11 lst-kix_p4uavbz3orai-0 start" start="1"><li class="c2 c3"><span>Verifica-se as timestamps e atualiza-se os status de todos os usu&aacute;rios</span></li><li class="c2 c3"><span>Envia-se a a&ccedil;&atilde;o como multicast a cada 10 segundos</span></li><li class="c2 c3"><span>Aguarda-se keepAlive de todos os usu&aacute;rios</span></li></ol><ol class="c11 lst-kix_p4uavbz3orai-1 start" start="1"><li class="c2 c12"><span>Caso seja encontrado algum usu&aacute;rio novo nas listas trocadas, esse deve ser adicionado &agrave; lista</span></li></ol><ol class="c11 lst-kix_p4uavbz3orai-0" start="4"><li class="c2 c3"><span>Para toda a&ccedil;&atilde;o keepAlive recebida, deve-se atualizar o timestamp desse usu&aacute;rio</span></li><li class="c2 c3"><span>Um usu&aacute;rio que permanecer mais de 60 segundos ausente deve ser eliminado da lista</span></li></ol><h2 class="c2 c6"><a name="h.8a0dtylxuhn3"></a><span class="c1">5</span><span class="c1">. Fluxo de excess&otilde;es</span></h2><p class="c2"><span>Esse protocolo se baseia no princ&iacute;pio de confiabilidade nas mensagens trocadas. N&atilde;o existe formas de validar se os programas-cliente realmente est&atilde;o agindo de acordo &agrave; mensagem enviada (um usu&aacute;rio pode enviar uma a&ccedil;&atilde;o Leave e se manter na sala, por exemplo).</span></p><p class="c0"><span></span></p><p class="c2"><span>O tratamento de erros proposto &eacute; apenas para mensagens incompletas, nas quais algum par&acirc;metro obrigat&oacute;rio est&aacute; ausente. Nesse caso, essa mensagem deve ser descartada, sem nenhum resultado no chat e nem na lista de usu&aacute;rios. O usu&aacute;rio que enviou a mensagem com erros deve ser informado atrav&eacute;s da a&ccedil;&atilde;o Report.</span></p><p class="c0"><span></span></p><p class="c2"><span>Note que todo par&acirc;metro ausente deve ser considerado como vazio, de forma que uma mensagem com a a&ccedil;&atilde;o &ldquo;Say&rdquo; que n&atilde;o possua o par&acirc;metro target deve ser direcionada &agrave; toda sala.</span></p><p class="c0"><span></span></p><h2 class="c2 c6"><a name="h.55q8s6g4djrz"></a><span class="c1">6. Configura&ccedil;&otilde;es padr&atilde;o</span></h2><p class="c2"><span>Porta: 9000</span></p><p class="c2"><span>Frequ&ecirc;ncia de envio de search (quando a lista de usu&aacute;rios est&aacute; vazia): 2 segundos</span></p><p class="c2"><span>Frequ&ecirc;ncia de envio de keepAlive: 10 segundos</span></p><p class="c2"><span>Formato de timestamp na janela de chat: hh:mm:ss</span></p><div><p class="c0"><span></span></p></div><div class="c9"><p class="c4">
